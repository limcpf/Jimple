<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="{{blogDescription}} - ì•„ì¹´ì´ë¸Œ" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="{{blogTitle}} - ì•„ì¹´ì´ë¸Œ" />
    <meta property="og:description" content="{{blogDescription}} - ëª¨ë“  ê²Œì‹œê¸€ê³¼ ì¹´í…Œê³ ë¦¬ë¥¼ ë‘˜ëŸ¬ë³´ì„¸ìš”" />
    <meta property="og:site_name" content="{{blogTitle}}" />
    <title>{{blogTitle}} - ì•„ì¹´ì´ë¸Œ</title>
    <link rel="stylesheet" href="assets/jimple.css" />
    <link rel="stylesheet" href="assets/list.css" />
</head>
<body>
<header class="top-header">
    <div class="header-container">
        <h1 class="logo">{{topTitle}}</h1>
        <nav class="main-menu">
            {{mainMenu}}
        </nav>
    </div>
</header>

<main class="content">
    <div class="archive-container">
        <div class="archive-header">
            <h2 class="archive-title">ì•„ì¹´ì´ë¸Œ</h2>
            <p class="archive-description">ëª¨ë“  ê²Œì‹œê¸€ê³¼ ì¹´í…Œê³ ë¦¬ë¥¼ íƒìƒ‰í•´ë³´ì„¸ìš”</p>
        </div>
        
        <div class="categories-section" id="categories-section">
            <!-- ì¹´í…Œê³ ë¦¬ êµ¬ì¡°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
    </div>
</main>

<footer>
    <p>{{footerText}}</p>
</footer>

<script>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê¸°ë³¸ ìœ í‹¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const $ = (sel, ctx = document) => ctx.querySelector(sel);
    const $$ = (sel, ctx = document) => ctx.querySelectorAll(sel);

    /* ë‚ ì§œ 'YYYY-MM-DD' â†’ 'YYYYë…„ Mì›” Dì¼' */
    const formatDate = (str) => {
        const [y, m, d] = str.split('-');
        return `${y}ë…„ ${+m}ì›” ${+d}ì¼`;
    };

    /* JSON fetch ê³µí†µ ë˜í¼ */
    const fetchJSON = async (url) => {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`Fetch ${url} â†’ ${res.status}`);
        return res.json();
    };

    /* URLì—ì„œ ì¹´í…Œê³ ë¦¬ ê²½ë¡œ ì¶”ì¶œ */
    const getCategoryFromUrl = () => {
        const params = new URLSearchParams(window.location.search);
        return params.get('category') || '';
    };

    /* ì¹´í…Œê³ ë¦¬ ë·°ë¥¼ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜ */
    const showCategoryView = (categoryPath) => {
        // ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ì„ ìˆ¨ê¸°ê³  ì¹´í…Œê³ ë¦¬ ë·°ë¥¼ í‘œì‹œ
        const categoriesSection = $('#categories-section');
        if (categoriesSection) {
            categoriesSection.style.display = 'none';
        }
        
        // ë™ì ìœ¼ë¡œ ì¹´í…Œê³ ë¦¬ ì»¨í…Œì´ë„ˆ ìƒì„±
        const existingCategoryView = $('#category-view');
        if (existingCategoryView) {
            existingCategoryView.remove();
        }
        
        const categoryView = document.createElement('div');
        categoryView.id = 'category-view';
        categoryView.innerHTML = `
            <div class="category-header">
                <nav class="breadcrumb" id="breadcrumb"></nav>
                <h2 class="category-title" id="category-title"></h2>
            </div>
            
            <div class="subcategories" id="subcategories"></div>
            <div class="post-list" id="post-list"></div>
        `;
        
        $('.archive-container').appendChild(categoryView);
        
        // ì¹´í…Œê³ ë¦¬ ë°ì´í„° ë¡œë“œ
        loadCategoryData(categoryPath);
    };

    /* ì•„ì¹´ì´ë¸Œ ë·°ë¥¼ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜ */
    const showArchiveView = () => {
        // ì¹´í…Œê³ ë¦¬ ë·°ë¥¼ ìˆ¨ê¸°ê³  ì•„ì¹´ì´ë¸Œ ë·°ë¥¼ í‘œì‹œ
        const categoryView = $('#category-view');
        if (categoryView) {
            categoryView.remove();
        }
        
        // ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ì„ í‘œì‹œ
        const categoriesSection = $('#categories-section');
        if (categoriesSection) {
            categoriesSection.style.display = 'block';
        }
    };

    /* ì¹´í…Œê³ ë¦¬ ë°ì´í„° ë¡œë“œ */
    const loadCategoryData = async (categoryPath = '') => {
        try {
            const fileName = categoryPath ? 
                `category-${categoryPath.replace(/\//g, '-')}.json` : 
                'category-root.json';
            
            const { posts, subCategories, categoryName } = await fetchJSON(`./${fileName}`);
            
            CategoryView.breadcrumb(categoryPath);
            CategoryView.categoryTitle(categoryName);
            await CategoryView.subcategories(subCategories);
            CategoryView.posts(posts);
            
        } catch (err) {
            console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', err);
            $('#post-list').innerHTML = '<div class="error">ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
    };

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì¹´í…Œê³ ë¦¬ ë·° ë Œë”ëŸ¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const CategoryView = {
        breadcrumb(categoryPath) {
            const parts = categoryPath ? categoryPath.split('/') : [];
            let currentPath = '';
            
            const breadcrumbItems = [
                '<a href="archive.html" class="breadcrumb-item">ì „ì²´</a>'
            ];
            
            for (const part of parts) {
                currentPath += (currentPath ? '/' : '') + part;
                breadcrumbItems.push(
                    `<a href="archive.html?category=${encodeURIComponent(currentPath)}" class="breadcrumb-item">${part}</a>`
                );
            }
            
            $('#breadcrumb').innerHTML = breadcrumbItems.join(' â€º ');
        },

        categoryTitle(categoryName) {
            if(!categoryName) {
                $('#category-title').textContent = 'ì „ì²´ ì¹´í…Œê³ ë¦¬';
            }
        },
        
        async subcategories(subCategories) {
            if (!subCategories || subCategories.length === 0) {
                $('#subcategories').innerHTML = '';
                return;
            }
            
            // ê° í•˜ìœ„ ì¹´í…Œê³ ë¦¬ì˜ í•˜ìœ„ ì¹´í…Œê³ ë¦¬ ê°œìˆ˜ë¥¼ ê³„ì‚°
            for (const category of subCategories) {
                category.subCategoryCount = await this.countSubCategories(category.fullPath);
            }
            
            const items = subCategories.map(category => `
                <div class="category-card">
                    <a href="archive.html?category=${encodeURIComponent(category.fullPath)}" class="category-link">
                        <div class="category-header">
                            <span class="category-icon">ğŸ“</span>
                            <span class="category-name">${category.name}</span>
                        </div>
                        <div class="category-stats">
                            <div class="stat-item">
                                <span class="stat-label">ê²Œì‹œê¸€</span>
                                <span class="stat-count">${category.postCount || 0}ê°œ</span>
                            </div>
                            ${category.subCategoryCount ? `
                                <div class="stat-item">
                                    <span class="stat-label">í•˜ìœ„ ì¹´í…Œê³ ë¦¬</span>
                                    <span class="stat-count">${category.subCategoryCount}ê°œ</span>
                                </div>
                            ` : ''}
                        </div>
                    </a>
                </div>
            `).join('');
            
            $('#subcategories').innerHTML = `
                <div class="subcategories-header">
                    <h3>í•˜ìœ„ ì¹´í…Œê³ ë¦¬</h3>
                </div>
                <div class="categories-grid">
                    ${items}
                </div>
            `;
        },

        async countSubCategories(categoryPath) {
            try {
                const fileName = `category-${categoryPath.replace(/\//g, '-')}.json`;
                const subCategoryData = await fetchJSON(`./${fileName}`);
                return subCategoryData.subCategories?.length || 0;
            } catch (err) {
                return 0;
            }
        },

        posts(posts) {
            if (!posts || posts.length === 0) {
                $('#post-list').innerHTML = '<div class="no-posts">ì´ ì¹´í…Œê³ ë¦¬ì—ëŠ” ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            $('#post-list').innerHTML = posts.map(this.postItem).join('');
        },

        postItem(p) {
            return `
              <div class="post-item">
                <div class="post-category">${p.categoryPath || 'uncategorized'}</div>
                <h2 class="post-title"><a href="${p.path}">${p.title}</a></h2>
                <time class="post-date">${formatDate(p.date)}</time>
                ${p.description ? `<p class="post-description">${p.description}</p>` : ''}
              </div>`;
        }
    };

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì•„ì¹´ì´ë¸Œ ë·° ë Œë”ëŸ¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const View = {
        categories(categoryData) {
            const categoriesSection = $('#categories-section');
            
            if (!categoryData || (!categoryData.subCategories?.length && !categoryData.posts?.length)) {
                categoriesSection.innerHTML = '<div class="no-content">ì•„ì§ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            let html = '';
            
            // ë£¨íŠ¸ ë ˆë²¨ ê²Œì‹œê¸€
            if (categoryData.posts?.length > 0) {
                html += `
                    <div class="category-group">
                        <h3 class="category-name">ğŸ“ ê¸°íƒ€</h3>
                        <div class="posts-grid">
                            ${categoryData.posts.map(post => this.postCard(post)).join('')}
                        </div>
                    </div>
                `;
            }
            
            // ìµœìƒìœ„ ì¹´í…Œê³ ë¦¬ë“¤ì„ ì¹´ë“œ í˜•íƒœë¡œ í‘œì‹œ
            if (categoryData.subCategories?.length > 0) {
                html += `
                    <div class="category-group">
                        <h3 class="category-name">ğŸ“ ì¹´í…Œê³ ë¦¬</h3>
                        <div class="categories-grid">
                            ${categoryData.subCategories.map(category => `
                                <div class="category-card">
                                    <a href="archive.html?category=${encodeURIComponent(category.fullPath)}" class="category-link">
                                        <div class="category-header">
                                            <span class="category-icon">ğŸ“</span>
                                            <span class="category-name">${category.name}</span>
                                        </div>
                                        <div class="category-stats">
                                            <div class="stat-item">
                                                <span class="stat-label">ê²Œì‹œê¸€</span>
                                                <span class="stat-count">${category.postCount || 0}ê°œ</span>
                                            </div>
                                            ${category.subCategoryCount ? `
                                                <div class="stat-item">
                                                    <span class="stat-label">í•˜ìœ„ ì¹´í…Œê³ ë¦¬</span>
                                                    <span class="stat-count">${category.subCategoryCount}ê°œ</span>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </a>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            categoriesSection.innerHTML = html;
        },
        
        
        postCard(post) {
            return `
                <div class="post-card">
                    <h4 class="post-title">
                        <a href="${post.path}">${post.title}</a>
                    </h4>
                    <time class="post-date">${formatDate(post.date)}</time>
                    ${post.description ? `<p class="post-description">${post.description}</p>` : ''}
                </div>
            `;
        }
    };

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const CategoryManager = {
        async loadCategories() {
            try {
                const categoryData = await this.loadCategoryDataWithSubcounts();
                View.categories(categoryData);
            } catch (err) {
                console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹¤íŒ¨:', err);
                $('#categories-section').innerHTML = '<div class="error">ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        },

        async loadCategoryDataWithSubcounts() {
            const categoryData = await fetchJSON('./category-root.json');
            
            // ê° ì¹´í…Œê³ ë¦¬ì— í•˜ìœ„ ì¹´í…Œê³ ë¦¬ ê°œìˆ˜ ì¶”ê°€
            if (categoryData.subCategories?.length > 0) {
                for (const category of categoryData.subCategories) {
                    category.subCategoryCount = await this.countSubCategories(category.fullPath);
                }
            }
            
            return categoryData;
        },

        async countSubCategories(categoryPath) {
            try {
                const fileName = `category-${categoryPath.replace(/\//g, '-')}.json`;
                const subCategoryData = await fetchJSON(`./${fileName}`);
                return subCategoryData.subCategories?.length || 0;
            } catch (err) {
                return 0;
            }
        }
    };


    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì´ˆê¸° êµ¬ë™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    document.addEventListener('DOMContentLoaded', () => {
        const categoryPath = getCategoryFromUrl();
        
        if (categoryPath) {
            // ì¹´í…Œê³ ë¦¬ íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ ì¹´í…Œê³ ë¦¬ ë·° í‘œì‹œ
            showCategoryView(categoryPath);
        } else {
            // ì¹´í…Œê³ ë¦¬ íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©´ ì•„ì¹´ì´ë¸Œ ë·° í‘œì‹œ
            showArchiveView();
            CategoryManager.loadCategories(); // ì¹´í…Œê³ ë¦¬ ë¡œë“œ
        }
    });
</script>

<style>
    .archive-container {
        max-width: 800px;
        padding: var(--space-3);
    }
    
    .archive-header {
        text-align: center;
        margin-bottom: 2rem;
        padding: 2rem 0;
        border-bottom: 1px solid var(--border);
    }
    
    .archive-title {
        margin: 0 0 0.5rem 0;
        font-size: 2.5rem;
        color: var(--fg);
    }
    
    .archive-description {
        margin: 0;
        color: var(--fg-muted);
        font-size: 1.1rem;
    }
    
    
    .category-group {
        margin-bottom: 2rem;
    }
    
    .category-name {
        font-weight: bold;
        font-size: 1.5rem;
        color: var(--fg);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    
    .posts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .categories-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
    }

    /* ì¹´í…Œê³ ë¦¬ ì¹´ë“œ ê°œì„ ëœ ìŠ¤íƒ€ì¼ */
    .category-stats {
        display: flex;
        gap: 1rem;
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        border-top: 1px solid var(--border);
    }

    .stat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
    }

    .stat-label {
        font-size: 0.8rem;
        color: var(--fg-muted);
        font-weight: normal;
    }

    .stat-count {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--fg);
    }
    
    .category-card {
        border: 1px solid var(--border);
        border-radius: 8px;
        background: var(--card);
        transition: box-shadow 0.3s ease, transform 0.2s ease;
    }
    
    .category-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }
    
    .category-link {
        display: block;
        text-decoration: none;
        color: inherit;
        padding: 1.5rem;
    }
    
    .category-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.5rem;
    }
    
    .category-icon {
        font-size: 1.5rem;
    }
    
    .category-header .category-name {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--fg);
        margin: 0;
    }
    
    
    .post-card {
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.5rem;
        background: var(--card);
        transition: box-shadow 0.3s ease;
    }
    
    .post-card:hover {
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .post-title {
        margin: 0 0 0.5rem 0;
        font-size: 1.1rem;
    }
    
    .post-title a {
        text-decoration: none;
        color: var(--fg);
    }
    
    .post-title a:hover {
        color: var(--link);
    }
    
    .post-date {
        font-size: 0.9rem;
        color: var(--fg-muted);
    }
    
    .post-description {
        margin: 0.5rem 0 0 0;
        color: var(--fg-muted);
        font-size: 0.9rem;
        line-height: 1.4;
    }
    
    /* ì¹´í…Œê³ ë¦¬ ë·° ìŠ¤íƒ€ì¼ */
    #category-view {
        margin-top: 2rem;
    }
    
    #category-view .category-header {
        margin-bottom: 2rem;
    }
    
    #category-view .breadcrumb {
        margin-bottom: 1rem;
        font-size: 0.9rem;
        color: var(--fg-muted);
    }
    
    #category-view .breadcrumb-item {
        color: var(--fg-muted);
        text-decoration: none;
    }
    
    #category-view .breadcrumb-item:hover {
        color: var(--fg);
        text-decoration: underline;
    }
    
    #category-view .category-title {
        margin: 0;
        font-size: 2rem;
        color: var(--fg);
    }
    
    #category-view .subcategories {
        margin-bottom: 2rem;
    }
    
    #category-view .subcategories-header h3 {
        margin: 0 0 1.5rem 0;
        font-size: 1.2rem;
        color: var(--fg);
    }
    
    #category-view .post-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    #category-view .post-item {
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.5rem;
        background: var(--card);
    }
    
    #category-view .post-category {
        font-size: 0.9rem;
        color: var(--fg-muted);
        margin-bottom: 0.5rem;
    }
    
    #category-view .post-title {
        margin: 0 0 0.5rem 0;
        font-size: 1.3rem;
    }
    
    #category-view .post-title a {
        text-decoration: none;
        color: var(--fg);
    }
    
    #category-view .post-title a:hover {
        color: var(--link);
    }
    
    #category-view .post-date {
        font-size: 0.9rem;
        color: var(--fg-muted);
    }
    
    #category-view .post-description {
        color: var(--fg-muted);
        font-size: 0.9rem;
        margin: 0.5rem 0 0 0;
        line-height: 1.4;
    }
    
    #category-view .no-posts {
        text-align: center;
        padding: 2rem;
        color: var(--fg-muted);
        font-style: italic;
    }

    
    
    .no-content, .error {
        text-align: center;
        padding: 2rem;
        color: var(--fg-muted);
        font-style: italic;
    }
    
    .error {
        color: #c33;
    }
    
    @media (max-width: 768px) {
        .posts-grid {
            grid-template-columns: 1fr;
        }
        
    }
</style>
</body>
</html>